"use strict";function ownKeys(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(t,!0).forEach(function(e){_defineProperty(r,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ownKeys(t).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))})}return r}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var User=require("../../models/user.model"),Order=require("../../models/order.model"),md5=require("md5"),moment=require("moment");module.exports.index=function(e,r){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:User.find().then(function(e){r.json(e)});case 1:case"end":return e.stop()}})},module.exports.deleteUser=function(r,t){var o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:o=r.params.id,console.log(o),User.find({_id:o}).then(function(e){t.json(e)});case 3:case"end":return e.stop()}})},module.exports.postCreate=function(e,r,t){var o=e.body;o.password=md5(e.body.password),o.DOB=moment(e.body.DOB).format(),o.avatar=e.file.path.split("/").slice(1).join("/"),User.create(e.body),200===r.statusCode?r.redirect("/admin/store-information"):r.json(r.statusCode)},module.exports.postCreateRecord=function(e,t,r){var o=e.params.id,n=e.body;""===n.Store?n.Store=o:n.Store,n.timeOrder=moment(e.body.timeOrder).format("YYYY-MM-DDTHH:MM:ss"),Order.find({Store:o}).lean().then(function(e){var r=_objectSpread({},e,{},n,{},{Store:null==n.Store?o:n.Store});return Order.create(r),t.redirect("/users/".concat(o))})},module.exports.getUser=function(e,r){var t=e.params.id;User.find({_id:t}).then(function(e){r.render("users/view",{user:user})})},module.exports.editOrder=function(e,r){var t=e.params.id,o=e.body,n=Buffer.from(e.cookies.type,"base64").toString("ascii");o.timeOrder=moment(e.body.timeOrder).format("YYYY-MM-DDTHH:MM:ss"),Order.updateOne({_id:t},o,{upsert:!0}).then(function(e){return console.log("Successfully"),r.redirect("/users/record/".concat(n.slice(5)))})};