"use strict";var User=require("../models/user.model"),Order=require("../models/order.model"),md5=require("md5");module.exports.index=function(e,n){var r=Buffer.from(e.cookies.type,"base64").toString("ascii"),t=r.slice(0,5).toString(),o=r.slice(5).toString();"Admin"===t?User.find({name:o}).then(function(r){Order.find({}).then(function(e){n.render("Layout/admin",{users:r,userAdmin:t,adminName:o,record:e})})}):n.redirect("/users")},module.exports.storeInformation=function(e,r){User.find({}).then(function(e){r.render("Admin/viewAllUser",{users:e})})},module.exports.searchUser=function(r,n){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:t=r.query.q.toLowerCase(),User.find({name:t}).then(function(e){n.render("Admin/viewAllUser",{users:e})});case 2:case"end":return e.stop()}})},module.exports.searchRecord=function(r,n){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:t=r.query.q.toLowerCase(),Order.find({product:t}).then(function(e){n.render("Admin/detailUser",{user:e})});case 2:case"end":return e.stop()}})},module.exports.createUser=function(e,r){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:r.render("Admin/createUser");case 1:case"end":return e.stop()}})},module.exports.getDetailUser=function(r,n){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:t=r.params.id,console.log(t),Order.find({Store:t}).then(function(e){n.render("Admin/detailUser",{user:e})});case 3:case"end":return e.stop()}})},module.exports.postCreate=function(e,r,n){var t=e.body;t.password=md5(e.body.password),t.avatar=e.file.path.split("/").slice(1).join("/"),User.create(e.body),r.redirect("/users")},module.exports.create=function(e,r){r.render("Order/order")},module.exports.deleteUser=function(r,n){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:t=r.params.id,User.findByIdAndDelete({_id:t}).then(function(e){n.redirect("/admin/store-information")});case 2:case"end":return e.stop()}})},module.exports.analyze=function(e,n){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:Order.find({}).then(function(e){var r=0;e.map(function(e){r+=parseInt(e.number)}),n.render("Admin/analyze",{items:e,totalNumber:r})});case 1:case"end":return e.stop()}})},module.exports.analyzeAscending=function(e,n){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:Order.find({}).then(function(e){var r=0;e.map(function(e){r+=parseInt(e.number)}),e.sort(function(e,r){return new Date(r.timeOrder)-new Date(e.timeOrder)}),n.render("Admin/analyze",{items:e,totalNumber:r})});case 1:case"end":return e.stop()}})},module.exports.analyzeDescending=function(e,n){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:Order.find({}).then(function(e){var r=0;e.map(function(e){r+=parseInt(e.number)}),e.sort(function(e,r){return new Date(e.timeOrder)-new Date(r.timeOrder)}),n.render("Admin/analyze",{items:e,totalNumber:r})});case 1:case"end":return e.stop()}})};